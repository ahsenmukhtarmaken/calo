2024-05-09T15:04:06.681Z INIT_START Runtime Version: nodejs:20.v22	Runtime Version ARN: arn:aws:lambda:us-east-1::runtime:da57c20c4b965d5b75540f6865a35fc8030358e33ec44ecfed33e90901a27a72

2024-05-09T15:04:07.724Z START RequestId: 76219974-a59e-5429-803b-c7c24d81ad1e Version: $LATEST

2024-05-09T15:04:07.877Z 2024-05-09T15:04:07.877Z	76219974-a59e-5429-803b-c7c24d81ad1e	INFO	Processing message bb4f47b0-8743-4129-bb08-1547bb8ce6d0

2024-05-09T15:04:07.915Z 2024-05-09T15:04:07.915Z	76219974-a59e-5429-803b-c7c24d81ad1e	ERROR	An error occured while syncing the balance TypeError: Cannot read properties of null (reading 'getBalance')
    at Zi.exec (/src/syncBalance/useCase.ts:55:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at JU (/src/syncBalance/listener.ts:30:7)
    at K0 (/node_modules/@middy/core/index.js:192:26)

2024-05-09T15:04:08.115Z {"_aws":{"Timestamp":1715267048115,"CloudWatchMetrics":[{"Namespace":"apiService","Dimensions":[["service"]],"Metrics":[{"Name":"synBalanceError","Unit":"Count"}]}]},"service":"syncBalanceSQS","synBalanceError":1}

2024-05-09T15:04:08.120Z END RequestId: 76219974-a59e-5429-803b-c7c24d81ad1e

2024-05-09T15:04:08.120Z REPORT RequestId: 76219974-a59e-5429-803b-c7c24d81ad1e	Duration: 395.74 ms	Billed Duration: 396 ms	Memory Size: 1024 MB	Max Memory Used: 132 MB	Init Duration: 1041.97 ms	

2024-05-09T15:05:36.354Z START RequestId: bb95acd7-4685-52f6-acac-f261aef7054f Version: $LATEST

2024-05-09T15:05:36.476Z 2024-05-09T15:05:36.476Z	bb95acd7-4685-52f6-acac-f261aef7054f	INFO	Processing message bb4f47b0-8743-4129-bb08-1547bb8ce6d0

2024-05-09T15:05:36.506Z 2024-05-09T15:05:36.506Z	bb95acd7-4685-52f6-acac-f261aef7054f	INFO	Start syncing the balance {
  transaction: {
    id: '01HXEY3Z34ECP9FS0ZYK52DKWS',
    type: 'CREDIT',
    source: 'PAYMENT',
    action: 'CREATE_SUBSCRIPTION_WEB',
    userId: 'bbaa9ed6-f6e1-4ecc-bffd-914a9806cb11',
    paymentBalance: 940,
    updatePaymentBalance: true,
    metadata: '{"walletId":"wallet#bbaa9ed6-f6e1-4ecc-bffd-914a9806cb11","eventSessionId":"fe356a39-7704-4d0a-9810-30e863a40aeb","walletSk":"d87db342-bfe7-41fe-a578-ae1250ac89a0","version2":true}',
    currency: 'SAR',
    amount: 1081,
    vat: 141,
    oldBalance: 940,
    newBalance: 1880
  }
}

2024-05-09T15:05:36.659Z 2024-05-09T15:05:36.659Z	bb95acd7-4685-52f6-acac-f261aef7054f	INFO	SubscriptionBalanceUpdated event published

2024-05-09T15:05:36.705Z 2024-05-09T15:05:36.705Z	bb95acd7-4685-52f6-acac-f261aef7054f	ERROR	Subscription balance and payment balance are not in sync {
  userId: 'bbaa9ed6-f6e1-4ecc-bffd-914a9806cb11',
  subscriptionBalance: 1880,
  paymentBalance: 940
}

2024-05-09T15:05:36.749Z END RequestId: bb95acd7-4685-52f6-acac-f261aef7054f

2024-05-09T15:05:36.749Z REPORT RequestId: bb95acd7-4685-52f6-acac-f261aef7054f	Duration: 394.47 ms	Billed Duration: 395 ms	Memory Size: 1024 MB	Max Memory Used: 148 MB	

