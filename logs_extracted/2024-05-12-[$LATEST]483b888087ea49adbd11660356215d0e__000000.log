2024-05-12T17:30:23.503Z INIT_START Runtime Version: nodejs:20.v22	Runtime Version ARN: arn:aws:lambda:us-east-1::runtime:da57c20c4b965d5b75540f6865a35fc8030358e33ec44ecfed33e90901a27a72

2024-05-12T17:30:24.532Z START RequestId: d8ccfde9-23b5-5a82-9d2c-a353dd6b0d2b Version: $LATEST

2024-05-12T17:30:24.687Z 2024-05-12T17:30:24.687Z	d8ccfde9-23b5-5a82-9d2c-a353dd6b0d2b	INFO	Processing message 638ee502-5e01-48fc-9b64-d9e8c9a34c11

2024-05-12T17:30:24.742Z 2024-05-12T17:30:24.742Z	d8ccfde9-23b5-5a82-9d2c-a353dd6b0d2b	ERROR	An error occured while syncing the balance TypeError: Cannot read properties of null (reading 'getBalance')
    at Zi.exec (/src/syncBalance/useCase.ts:55:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at JU (/src/syncBalance/listener.ts:30:7)
    at K0 (/node_modules/@middy/core/index.js:192:26)

2024-05-12T17:30:24.938Z {"_aws":{"Timestamp":1715535024927,"CloudWatchMetrics":[{"Namespace":"apiService","Dimensions":[["service"]],"Metrics":[{"Name":"synBalanceError","Unit":"Count"}]}]},"service":"syncBalanceSQS","synBalanceError":1}

2024-05-12T17:30:24.941Z END RequestId: d8ccfde9-23b5-5a82-9d2c-a353dd6b0d2b

2024-05-12T17:30:24.941Z REPORT RequestId: d8ccfde9-23b5-5a82-9d2c-a353dd6b0d2b	Duration: 409.32 ms	Billed Duration: 410 ms	Memory Size: 1024 MB	Max Memory Used: 132 MB	Init Duration: 1028.27 ms	

2024-05-12T17:31:53.256Z START RequestId: 152831d8-c54c-50f6-a59b-6f623a0f375f Version: $LATEST

2024-05-12T17:31:53.460Z 2024-05-12T17:31:53.460Z	152831d8-c54c-50f6-a59b-6f623a0f375f	INFO	Processing message 638ee502-5e01-48fc-9b64-d9e8c9a34c11

2024-05-12T17:31:53.470Z 2024-05-12T17:31:53.470Z	152831d8-c54c-50f6-a59b-6f623a0f375f	INFO	Start syncing the balance {
  transaction: {
    id: '01HXPXNZE21VCSQX2X2H8PVKTC',
    type: 'CREDIT',
    source: 'PAYMENT',
    action: 'CREATE_SUBSCRIPTION_WEB',
    userId: 'ea65d901-c13b-468f-bfa7-9920246c4dc4',
    paymentBalance: 1800,
    updatePaymentBalance: true,
    metadata: '{"walletId":"wallet#ea65d901-c13b-468f-bfa7-9920246c4dc4","eventSessionId":"77928214-35aa-437a-93f5-676092b22689","walletSk":"c1ed911b-c14b-4549-a798-fd0520fc69bb","version2":true}',
    currency: 'SAR',
    amount: 2070,
    vat: 270,
    oldBalance: 1800,
    newBalance: 3600
  }
}

2024-05-12T17:31:53.623Z 2024-05-12T17:31:53.623Z	152831d8-c54c-50f6-a59b-6f623a0f375f	INFO	SubscriptionBalanceUpdated event published

2024-05-12T17:31:53.668Z 2024-05-12T17:31:53.668Z	152831d8-c54c-50f6-a59b-6f623a0f375f	ERROR	Subscription balance and payment balance are not in sync {
  userId: 'ea65d901-c13b-468f-bfa7-9920246c4dc4',
  subscriptionBalance: 3600,
  paymentBalance: 1800
}

2024-05-12T17:31:53.701Z END RequestId: 152831d8-c54c-50f6-a59b-6f623a0f375f

2024-05-12T17:31:53.701Z REPORT RequestId: 152831d8-c54c-50f6-a59b-6f623a0f375f	Duration: 445.43 ms	Billed Duration: 446 ms	Memory Size: 1024 MB	Max Memory Used: 147 MB	

