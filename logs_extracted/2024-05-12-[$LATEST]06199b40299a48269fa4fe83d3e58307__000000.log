2024-05-12T11:47:49.012Z INIT_START Runtime Version: nodejs:20.v22	Runtime Version ARN: arn:aws:lambda:us-east-1::runtime:da57c20c4b965d5b75540f6865a35fc8030358e33ec44ecfed33e90901a27a72

2024-05-12T11:47:49.976Z START RequestId: e72ca1b0-c55e-504a-95df-ff0a6bc4c019 Version: $LATEST

2024-05-12T11:47:50.112Z 2024-05-12T11:47:50.112Z	e72ca1b0-c55e-504a-95df-ff0a6bc4c019	INFO	Processing message 16b84372-b371-49c1-bae2-fc709995169f

2024-05-12T11:47:50.165Z 2024-05-12T11:47:50.165Z	e72ca1b0-c55e-504a-95df-ff0a6bc4c019	ERROR	An error occured while syncing the balance TypeError: Cannot read properties of null (reading 'getBalance')
    at Zi.exec (/src/syncBalance/useCase.ts:55:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at JU (/src/syncBalance/listener.ts:30:7)
    at K0 (/node_modules/@middy/core/index.js:192:26)

2024-05-12T11:47:50.325Z {"_aws":{"Timestamp":1715514470325,"CloudWatchMetrics":[{"Namespace":"apiService","Dimensions":[["service"]],"Metrics":[{"Name":"synBalanceError","Unit":"Count"}]}]},"service":"syncBalanceSQS","synBalanceError":1}

2024-05-12T11:47:50.328Z END RequestId: e72ca1b0-c55e-504a-95df-ff0a6bc4c019

2024-05-12T11:47:50.328Z REPORT RequestId: e72ca1b0-c55e-504a-95df-ff0a6bc4c019	Duration: 351.98 ms	Billed Duration: 352 ms	Memory Size: 1024 MB	Max Memory Used: 131 MB	Init Duration: 962.86 ms	

2024-05-12T11:49:18.736Z START RequestId: cf737774-1a59-518c-87e3-29ceb4a86f70 Version: $LATEST

2024-05-12T11:49:18.850Z 2024-05-12T11:49:18.850Z	cf737774-1a59-518c-87e3-29ceb4a86f70	INFO	Processing message 16b84372-b371-49c1-bae2-fc709995169f

2024-05-12T11:49:18.893Z 2024-05-12T11:49:18.893Z	cf737774-1a59-518c-87e3-29ceb4a86f70	INFO	Start syncing the balance {
  transaction: {
    id: '01HXPA2Q3EYBVXKHQFFW967BTM',
    type: 'CREDIT',
    source: 'PAYMENT',
    action: 'CREATE_SUBSCRIPTION_WEB',
    userId: 'e0eedf6d-21c3-4cec-b12f-8c034c99d809',
    paymentBalance: 1800,
    updatePaymentBalance: true,
    metadata: '{"walletId":"wallet#e0eedf6d-21c3-4cec-b12f-8c034c99d809","eventSessionId":"90405488-9c28-41c9-a867-80fd36da98b9","walletSk":"957a6e54-55b7-4340-9ad5-3b4fc63497c2","version2":true}',
    currency: 'SAR',
    amount: 2070,
    vat: 270,
    oldBalance: 1800,
    newBalance: 3600
  }
}

2024-05-12T11:49:19.019Z 2024-05-12T11:49:19.019Z	cf737774-1a59-518c-87e3-29ceb4a86f70	INFO	SubscriptionBalanceUpdated event published

2024-05-12T11:49:19.057Z 2024-05-12T11:49:19.057Z	cf737774-1a59-518c-87e3-29ceb4a86f70	ERROR	Subscription balance and payment balance are not in sync {
  userId: 'e0eedf6d-21c3-4cec-b12f-8c034c99d809',
  subscriptionBalance: 3600,
  paymentBalance: 1800
}

2024-05-12T11:49:19.085Z END RequestId: cf737774-1a59-518c-87e3-29ceb4a86f70

2024-05-12T11:49:19.085Z REPORT RequestId: cf737774-1a59-518c-87e3-29ceb4a86f70	Duration: 349.18 ms	Billed Duration: 350 ms	Memory Size: 1024 MB	Max Memory Used: 147 MB	

