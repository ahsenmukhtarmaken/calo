2024-05-12T16:18:00.236Z START RequestId: c7ffcfa5-12e7-50f7-b1ea-911fff13e4cf Version: $LATEST

2024-05-12T16:18:00.405Z 2024-05-12T16:18:00.405Z	c7ffcfa5-12e7-50f7-b1ea-911fff13e4cf	INFO	Processing message 88af83a7-a356-4b64-82b8-7d31fc1e6587

2024-05-12T16:18:00.446Z 2024-05-12T16:18:00.446Z	c7ffcfa5-12e7-50f7-b1ea-911fff13e4cf	ERROR	An error occured while syncing the balance TypeError: Cannot read properties of null (reading 'getBalance')
    at Zi.exec (/src/syncBalance/useCase.ts:55:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at JU (/src/syncBalance/listener.ts:30:7)
    at K0 (/node_modules/@middy/core/index.js:192:26)

2024-05-12T16:18:00.643Z {"_aws":{"Timestamp":1715530680642,"CloudWatchMetrics":[{"Namespace":"apiService","Dimensions":[["service"]],"Metrics":[{"Name":"synBalanceError","Unit":"Count"}]}]},"service":"syncBalanceSQS","synBalanceError":1}

2024-05-12T16:18:00.646Z END RequestId: c7ffcfa5-12e7-50f7-b1ea-911fff13e4cf

2024-05-12T16:18:00.646Z REPORT RequestId: c7ffcfa5-12e7-50f7-b1ea-911fff13e4cf	Duration: 410.17 ms	Billed Duration: 411 ms	Memory Size: 1024 MB	Max Memory Used: 133 MB	Init Duration: 994.68 ms	

2024-05-12T16:17:59.240Z INIT_START Runtime Version: nodejs:20.v22	Runtime Version ARN: arn:aws:lambda:us-east-1::runtime:da57c20c4b965d5b75540f6865a35fc8030358e33ec44ecfed33e90901a27a72

2024-05-12T16:19:29.142Z START RequestId: 8d966ada-a732-50bb-ba01-34604974e1e0 Version: $LATEST

2024-05-12T16:19:29.303Z 2024-05-12T16:19:29.303Z	8d966ada-a732-50bb-ba01-34604974e1e0	INFO	Processing message 88af83a7-a356-4b64-82b8-7d31fc1e6587

2024-05-12T16:19:29.314Z 2024-05-12T16:19:29.314Z	8d966ada-a732-50bb-ba01-34604974e1e0	INFO	Start syncing the balance {
  transaction: {
    id: '01HXPSHDBNFFS06V483KEQEP05',
    type: 'CREDIT',
    source: 'PAYMENT',
    action: 'CREATE_SUBSCRIPTION_WEB',
    userId: '76cb24e4-60e0-46c5-a585-57ecf8bfb528',
    paymentBalance: 1800,
    updatePaymentBalance: true,
    metadata: '{"walletId":"wallet#76cb24e4-60e0-46c5-a585-57ecf8bfb528","eventSessionId":"77117a91-2d5d-4fd9-b03e-57f963b3f4c3","walletSk":"c229045e-ae15-4a3a-bc0d-3840a4c1ec37","version2":true}',
    currency: 'SAR',
    amount: 2070,
    vat: 270,
    oldBalance: 1800,
    newBalance: 3600
  }
}

2024-05-12T16:19:29.460Z 2024-05-12T16:19:29.460Z	8d966ada-a732-50bb-ba01-34604974e1e0	INFO	SubscriptionBalanceUpdated event published

2024-05-12T16:19:29.507Z 2024-05-12T16:19:29.507Z	8d966ada-a732-50bb-ba01-34604974e1e0	ERROR	Subscription balance and payment balance are not in sync {
  userId: '76cb24e4-60e0-46c5-a585-57ecf8bfb528',
  subscriptionBalance: 3600,
  paymentBalance: 1800
}

2024-05-12T16:19:29.540Z END RequestId: 8d966ada-a732-50bb-ba01-34604974e1e0

2024-05-12T16:19:29.540Z REPORT RequestId: 8d966ada-a732-50bb-ba01-34604974e1e0	Duration: 398.58 ms	Billed Duration: 399 ms	Memory Size: 1024 MB	Max Memory Used: 135 MB	

2024-05-12T16:23:30.495Z START RequestId: 08aaa3a3-0d78-518b-ae73-fd19e25641a8 Version: $LATEST

2024-05-12T16:23:30.616Z 2024-05-12T16:23:30.616Z	08aaa3a3-0d78-518b-ae73-fd19e25641a8	INFO	Processing message 59f196c2-a3fe-42c2-b050-fea208b5be9b

2024-05-12T16:23:30.644Z 2024-05-12T16:23:30.644Z	08aaa3a3-0d78-518b-ae73-fd19e25641a8	ERROR	An error occured while syncing the balance TypeError: Cannot read properties of null (reading 'getBalance')
    at Zi.exec (/src/syncBalance/useCase.ts:55:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at JU (/src/syncBalance/listener.ts:30:7)
    at K0 (/node_modules/@middy/core/index.js:192:26)

2024-05-12T16:23:30.645Z {"_aws":{"Timestamp":1715531010644,"CloudWatchMetrics":[{"Namespace":"apiService","Dimensions":[["service"]],"Metrics":[{"Name":"synBalanceError","Unit":"Count"}]}]},"service":"syncBalanceSQS","synBalanceError":1}

2024-05-12T16:23:30.646Z END RequestId: 08aaa3a3-0d78-518b-ae73-fd19e25641a8

2024-05-12T16:23:30.646Z REPORT RequestId: 08aaa3a3-0d78-518b-ae73-fd19e25641a8	Duration: 151.40 ms	Billed Duration: 152 ms	Memory Size: 1024 MB	Max Memory Used: 135 MB	

2024-05-12T16:25:00.529Z START RequestId: f6c8a6f5-58dd-5874-9259-f84fb754d5cc Version: $LATEST

2024-05-12T16:25:00.664Z 2024-05-12T16:25:00.664Z	f6c8a6f5-58dd-5874-9259-f84fb754d5cc	INFO	Processing message 59f196c2-a3fe-42c2-b050-fea208b5be9b

2024-05-12T16:25:00.672Z 2024-05-12T16:25:00.672Z	f6c8a6f5-58dd-5874-9259-f84fb754d5cc	INFO	Start syncing the balance {
  transaction: {
    id: '01HXPSVJMNKRBEQYDNJJM5HY76',
    type: 'CREDIT',
    source: 'PAYMENT',
    action: 'CREATE_SUBSCRIPTION_WEB',
    userId: '2e24caa6-55e4-482f-b84f-322df55cf796',
    paymentBalance: 1800,
    updatePaymentBalance: true,
    metadata: '{"walletId":"wallet#2e24caa6-55e4-482f-b84f-322df55cf796","eventSessionId":"ac8a758b-406a-4d95-8e60-90974042574a","walletSk":"c1ad5154-0a15-4631-94e7-a33e7483a626","version2":true}',
    currency: 'SAR',
    amount: 2070,
    vat: 270,
    oldBalance: 1800,
    newBalance: 3600
  }
}

2024-05-12T16:25:00.781Z 2024-05-12T16:25:00.781Z	f6c8a6f5-58dd-5874-9259-f84fb754d5cc	INFO	SubscriptionBalanceUpdated event published

2024-05-12T16:25:00.817Z 2024-05-12T16:25:00.817Z	f6c8a6f5-58dd-5874-9259-f84fb754d5cc	ERROR	Subscription balance and payment balance are not in sync {
  userId: '2e24caa6-55e4-482f-b84f-322df55cf796',
  subscriptionBalance: 3600,
  paymentBalance: 1800
}

2024-05-12T16:25:00.846Z END RequestId: f6c8a6f5-58dd-5874-9259-f84fb754d5cc

2024-05-12T16:25:00.846Z REPORT RequestId: f6c8a6f5-58dd-5874-9259-f84fb754d5cc	Duration: 317.19 ms	Billed Duration: 318 ms	Memory Size: 1024 MB	Max Memory Used: 135 MB	

