2024-05-12T11:54:48.847Z INIT_START Runtime Version: nodejs:20.v22	Runtime Version ARN: arn:aws:lambda:us-east-1::runtime:da57c20c4b965d5b75540f6865a35fc8030358e33ec44ecfed33e90901a27a72

2024-05-12T11:54:49.809Z START RequestId: ff4eb880-fad5-5f67-9beb-e63a4aef8ec3 Version: $LATEST

2024-05-12T11:54:49.944Z 2024-05-12T11:54:49.944Z	ff4eb880-fad5-5f67-9beb-e63a4aef8ec3	INFO	Processing message 835d71bc-49c5-48bf-8e8a-b3ec02ce7ca6

2024-05-12T11:54:49.998Z 2024-05-12T11:54:49.998Z	ff4eb880-fad5-5f67-9beb-e63a4aef8ec3	ERROR	An error occured while syncing the balance TypeError: Cannot read properties of null (reading 'getBalance')
    at Zi.exec (/src/syncBalance/useCase.ts:55:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at JU (/src/syncBalance/listener.ts:30:7)
    at K0 (/node_modules/@middy/core/index.js:192:26)

2024-05-12T11:54:50.198Z {"_aws":{"Timestamp":1715514890197,"CloudWatchMetrics":[{"Namespace":"apiService","Dimensions":[["service"]],"Metrics":[{"Name":"synBalanceError","Unit":"Count"}]}]},"service":"syncBalanceSQS","synBalanceError":1}

2024-05-12T11:54:50.200Z END RequestId: ff4eb880-fad5-5f67-9beb-e63a4aef8ec3

2024-05-12T11:54:50.200Z REPORT RequestId: ff4eb880-fad5-5f67-9beb-e63a4aef8ec3	Duration: 390.91 ms	Billed Duration: 391 ms	Memory Size: 1024 MB	Max Memory Used: 127 MB	Init Duration: 960.53 ms	

2024-05-12T11:56:18.578Z START RequestId: 083a4f2c-dc10-541b-aa72-11966c80b9a1 Version: $LATEST

2024-05-12T11:56:18.776Z 2024-05-12T11:56:18.776Z	083a4f2c-dc10-541b-aa72-11966c80b9a1	INFO	Processing message 835d71bc-49c5-48bf-8e8a-b3ec02ce7ca6

2024-05-12T11:56:18.786Z 2024-05-12T11:56:18.786Z	083a4f2c-dc10-541b-aa72-11966c80b9a1	INFO	Start syncing the balance {
  transaction: {
    id: '01HXPAFGZHQARVNFN8M909HY70',
    type: 'CREDIT',
    source: 'PAYMENT',
    action: 'CREATE_SUBSCRIPTION_WEB',
    userId: '34da8625-71ba-4993-bf09-80b734a942a9',
    paymentBalance: 1800,
    updatePaymentBalance: true,
    metadata: '{"walletId":"wallet#34da8625-71ba-4993-bf09-80b734a942a9","eventSessionId":"3ac66da8-73c4-4487-94d2-c7ef38dc592a","walletSk":"18dd69e9-ec97-4b7e-94c6-8cb6fa819da4","version2":true}',
    currency: 'SAR',
    amount: 2070,
    vat: 270,
    oldBalance: 1800,
    newBalance: 3600
  }
}

2024-05-12T11:56:18.925Z 2024-05-12T11:56:18.925Z	083a4f2c-dc10-541b-aa72-11966c80b9a1	INFO	SubscriptionBalanceUpdated event published

2024-05-12T11:56:18.966Z 2024-05-12T11:56:18.966Z	083a4f2c-dc10-541b-aa72-11966c80b9a1	ERROR	Subscription balance and payment balance are not in sync {
  userId: '34da8625-71ba-4993-bf09-80b734a942a9',
  subscriptionBalance: 3600,
  paymentBalance: 1800
}

2024-05-12T11:56:18.996Z END RequestId: 083a4f2c-dc10-541b-aa72-11966c80b9a1

2024-05-12T11:56:18.996Z REPORT RequestId: 083a4f2c-dc10-541b-aa72-11966c80b9a1	Duration: 417.70 ms	Billed Duration: 418 ms	Memory Size: 1024 MB	Max Memory Used: 145 MB	

