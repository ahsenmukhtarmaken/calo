2024-05-12T19:47:50.145Z START RequestId: 85b8cc38-488b-5190-9b6e-92835798f6ea Version: $LATEST

2024-05-12T19:47:50.174Z 2024-05-12T19:47:50.174Z	85b8cc38-488b-5190-9b6e-92835798f6ea	INFO	Processing message 0e18854c-f56a-412a-ad54-6a6847c74411

2024-05-12T19:47:50.180Z 2024-05-12T19:47:50.180Z	85b8cc38-488b-5190-9b6e-92835798f6ea	ERROR	An error occured while syncing the balance TypeError: Cannot read properties of null (reading 'getBalance')
    at Zi.exec (/src/syncBalance/useCase.ts:55:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at JU (/src/syncBalance/listener.ts:30:7)
    at K0 (/node_modules/@middy/core/index.js:192:26)

2024-05-12T19:47:50.181Z {"_aws":{"Timestamp":1715543270180,"CloudWatchMetrics":[{"Namespace":"apiService","Dimensions":[["service"]],"Metrics":[{"Name":"synBalanceError","Unit":"Count"}]}]},"service":"syncBalanceSQS","synBalanceError":1}

2024-05-12T19:47:50.182Z END RequestId: 85b8cc38-488b-5190-9b6e-92835798f6ea

2024-05-12T19:47:50.182Z REPORT RequestId: 85b8cc38-488b-5190-9b6e-92835798f6ea	Duration: 37.24 ms	Billed Duration: 38 ms	Memory Size: 1024 MB	Max Memory Used: 150 MB	

2024-05-12T19:41:52.274Z START RequestId: 4f5488a5-2857-5e8e-b570-d61e35f96427 Version: $LATEST

2024-05-12T19:41:52.448Z 2024-05-12T19:41:52.448Z	4f5488a5-2857-5e8e-b570-d61e35f96427	INFO	Processing message 7eee19a6-eb28-436a-8456-2edd91bbdee8

2024-05-12T19:41:52.485Z 2024-05-12T19:41:52.485Z	4f5488a5-2857-5e8e-b570-d61e35f96427	INFO	Start syncing the balance {
  transaction: {
    id: '01HXQ53ZK2Z0Y79YR0JVVB1Z1W',
    type: 'CREDIT',
    source: 'PAYMENT',
    action: 'CREATE_SUBSCRIPTION_WEB',
    userId: '2d28833d-531e-4ad1-93cb-55ec6e3329c1',
    paymentBalance: 1800,
    updatePaymentBalance: true,
    metadata: '{"walletId":"wallet#2d28833d-531e-4ad1-93cb-55ec6e3329c1","eventSessionId":"dc3dc965-892e-48c3-b02e-5c579c3eacd0","walletSk":"0befaf50-ae70-4dda-aa9a-b00d39b008ec","version2":true}',
    currency: 'SAR',
    amount: 2070,
    vat: 270,
    oldBalance: 1800,
    newBalance: 3600
  }
}

2024-05-12T19:41:52.628Z 2024-05-12T19:41:52.628Z	4f5488a5-2857-5e8e-b570-d61e35f96427	INFO	SubscriptionBalanceUpdated event published

2024-05-12T19:41:52.670Z 2024-05-12T19:41:52.670Z	4f5488a5-2857-5e8e-b570-d61e35f96427	ERROR	Subscription balance and payment balance are not in sync {
  userId: '2d28833d-531e-4ad1-93cb-55ec6e3329c1',
  subscriptionBalance: 3600,
  paymentBalance: 1800
}

2024-05-12T19:41:52.699Z END RequestId: 4f5488a5-2857-5e8e-b570-d61e35f96427

2024-05-12T19:41:52.699Z REPORT RequestId: 4f5488a5-2857-5e8e-b570-d61e35f96427	Duration: 425.69 ms	Billed Duration: 426 ms	Memory Size: 1024 MB	Max Memory Used: 150 MB	

2024-05-12T19:45:40.890Z START RequestId: faa0c1a0-9c91-55f1-9124-9f1b82063e04 Version: $LATEST

2024-05-12T19:45:41.070Z 2024-05-12T19:45:41.070Z	faa0c1a0-9c91-55f1-9124-9f1b82063e04	INFO	Processing message ee9a1639-e657-4a1e-af9e-8156b5794d4d

2024-05-12T19:45:41.100Z 2024-05-12T19:45:41.100Z	faa0c1a0-9c91-55f1-9124-9f1b82063e04	ERROR	An error occured while syncing the balance TypeError: Cannot read properties of null (reading 'getBalance')
    at Zi.exec (/src/syncBalance/useCase.ts:55:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at JU (/src/syncBalance/listener.ts:30:7)
    at K0 (/node_modules/@middy/core/index.js:192:26)

2024-05-12T19:45:41.102Z {"_aws":{"Timestamp":1715543141101,"CloudWatchMetrics":[{"Namespace":"apiService","Dimensions":[["service"]],"Metrics":[{"Name":"synBalanceError","Unit":"Count"}]}]},"service":"syncBalanceSQS","synBalanceError":1}

2024-05-12T19:45:41.103Z END RequestId: faa0c1a0-9c91-55f1-9124-9f1b82063e04

2024-05-12T19:45:41.103Z REPORT RequestId: faa0c1a0-9c91-55f1-9124-9f1b82063e04	Duration: 213.12 ms	Billed Duration: 214 ms	Memory Size: 1024 MB	Max Memory Used: 150 MB	

2024-05-12T19:40:22.793Z INIT_START Runtime Version: nodejs:20.v22	Runtime Version ARN: arn:aws:lambda:us-east-1::runtime:da57c20c4b965d5b75540f6865a35fc8030358e33ec44ecfed33e90901a27a72

2024-05-12T19:47:10.924Z START RequestId: cf6ccdbf-96e6-54e1-97c4-9304880bf39b Version: $LATEST

2024-05-12T19:47:11.080Z 2024-05-12T19:47:11.080Z	cf6ccdbf-96e6-54e1-97c4-9304880bf39b	INFO	Processing message ee9a1639-e657-4a1e-af9e-8156b5794d4d

2024-05-12T19:47:11.088Z 2024-05-12T19:47:11.088Z	cf6ccdbf-96e6-54e1-97c4-9304880bf39b	INFO	Start syncing the balance {
  transaction: {
    id: '01HXQ5DSF3ZGFXQWN8RBYBR355',
    type: 'CREDIT',
    source: 'PAYMENT',
    action: 'CREATE_SUBSCRIPTION_WEB',
    userId: 'e2bd0a8e-4904-4615-9c70-5c0c67a129c0',
    paymentBalance: 1800,
    updatePaymentBalance: true,
    metadata: '{"walletId":"wallet#e2bd0a8e-4904-4615-9c70-5c0c67a129c0","eventSessionId":"5a3e150c-7d36-4481-8e57-e1f866691f5c","walletSk":"2e5f6da5-6eb7-4f1b-b285-2f8f44b5aae4","version2":true}',
    currency: 'SAR',
    amount: 2070,
    vat: 270,
    oldBalance: 1800,
    newBalance: 3600
  }
}

2024-05-12T19:47:11.190Z 2024-05-12T19:47:11.190Z	cf6ccdbf-96e6-54e1-97c4-9304880bf39b	INFO	SubscriptionBalanceUpdated event published

2024-05-12T19:47:11.231Z 2024-05-12T19:47:11.231Z	cf6ccdbf-96e6-54e1-97c4-9304880bf39b	ERROR	Subscription balance and payment balance are not in sync {
  userId: 'e2bd0a8e-4904-4615-9c70-5c0c67a129c0',
  subscriptionBalance: 3600,
  paymentBalance: 1800
}

2024-05-12T19:47:11.258Z END RequestId: cf6ccdbf-96e6-54e1-97c4-9304880bf39b

2024-05-12T19:47:11.258Z REPORT RequestId: cf6ccdbf-96e6-54e1-97c4-9304880bf39b	Duration: 333.94 ms	Billed Duration: 334 ms	Memory Size: 1024 MB	Max Memory Used: 150 MB	

2024-05-12T19:49:20.201Z START RequestId: 78cfef25-12cd-580c-9dcb-b19e0da0ade0 Version: $LATEST

2024-05-12T19:49:20.253Z 2024-05-12T19:49:20.253Z	78cfef25-12cd-580c-9dcb-b19e0da0ade0	INFO	Processing message 0e18854c-f56a-412a-ad54-6a6847c74411

2024-05-12T19:49:20.260Z 2024-05-12T19:49:20.260Z	78cfef25-12cd-580c-9dcb-b19e0da0ade0	INFO	Start syncing the balance {
  transaction: {
    id: '01HXQ5HQRJ8CBESB89VJFBAYEX',
    type: 'CREDIT',
    source: 'PAYMENT',
    action: 'CREATE_SUBSCRIPTION_WEB',
    userId: 'a14aa589-0355-43f7-ab70-f4e230e1be91',
    paymentBalance: 1800,
    updatePaymentBalance: true,
    metadata: '{"walletId":"wallet#a14aa589-0355-43f7-ab70-f4e230e1be91","eventSessionId":"d26c3595-1c65-490e-86ea-c098c42f4827","walletSk":"2dc0d0aa-8fc3-4089-a891-65384bd1129a","version2":true}',
    currency: 'SAR',
    amount: 2070,
    vat: 270,
    oldBalance: 1800,
    newBalance: 3600
  }
}

2024-05-12T19:49:20.380Z 2024-05-12T19:49:20.380Z	78cfef25-12cd-580c-9dcb-b19e0da0ade0	INFO	SubscriptionBalanceUpdated event published

2024-05-12T19:49:20.420Z 2024-05-12T19:49:20.420Z	78cfef25-12cd-580c-9dcb-b19e0da0ade0	ERROR	Subscription balance and payment balance are not in sync {
  userId: 'a14aa589-0355-43f7-ab70-f4e230e1be91',
  subscriptionBalance: 3600,
  paymentBalance: 1800
}

2024-05-12T19:49:20.452Z END RequestId: 78cfef25-12cd-580c-9dcb-b19e0da0ade0

2024-05-12T19:49:20.452Z REPORT RequestId: 78cfef25-12cd-580c-9dcb-b19e0da0ade0	Duration: 250.95 ms	Billed Duration: 251 ms	Memory Size: 1024 MB	Max Memory Used: 150 MB	

2024-05-12T19:40:23.817Z START RequestId: 83fb71df-4f3d-5893-bef5-2f645269ead7 Version: $LATEST

2024-05-12T19:40:23.976Z 2024-05-12T19:40:23.976Z	83fb71df-4f3d-5893-bef5-2f645269ead7	INFO	Processing message 7eee19a6-eb28-436a-8456-2edd91bbdee8

2024-05-12T19:40:24.021Z 2024-05-12T19:40:24.021Z	83fb71df-4f3d-5893-bef5-2f645269ead7	ERROR	An error occured while syncing the balance TypeError: Cannot read properties of null (reading 'getBalance')
    at Zi.exec (/src/syncBalance/useCase.ts:55:37)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at JU (/src/syncBalance/listener.ts:30:7)
    at K0 (/node_modules/@middy/core/index.js:192:26)

2024-05-12T19:40:24.195Z {"_aws":{"Timestamp":1715542824194,"CloudWatchMetrics":[{"Namespace":"apiService","Dimensions":[["service"]],"Metrics":[{"Name":"synBalanceError","Unit":"Count"}]}]},"service":"syncBalanceSQS","synBalanceError":1}

2024-05-12T19:40:24.200Z END RequestId: 83fb71df-4f3d-5893-bef5-2f645269ead7

2024-05-12T19:40:24.200Z REPORT RequestId: 83fb71df-4f3d-5893-bef5-2f645269ead7	Duration: 382.84 ms	Billed Duration: 383 ms	Memory Size: 1024 MB	Max Memory Used: 133 MB	Init Duration: 1023.30 ms	

